# Docker Compose file for QuizBoutiqueBot
# Pulls pre-built image from GitHub Container Registry

services:
  quizboutiquebot:
    image: ghcr.io/skysoulkeeper/quizboutiquebot:latest
    container_name: quizboutiquebot

    # Environment variables
    environment:
      # Required
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:?TELEGRAM_BOT_TOKEN is required}

      # Optional with defaults
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID:-}
      QBB_LANGUAGE: ${QBB_LANGUAGE:-en}
      QBB_PARSE_MODE: ${QBB_PARSE_MODE:-HTML}
      QBB_LOG_TO_FILE: ${QBB_LOG_TO_FILE:-false}
      QBB_LOG_LEVEL: ${QBB_LOG_LEVEL:-INFO}

      # Proxy settings
      QBB_PROXY_ENABLED: ${QBB_PROXY_ENABLED:-false}
      QBB_PROXY_HOST: ${QBB_PROXY_HOST:-}
      QBB_PROXY_PORT: ${QBB_PROXY_PORT:-1080}
      QBB_PROXY_PROTOCOL: ${QBB_PROXY_PROTOCOL:-socks}
      QBB_PROXY_USERNAME: ${QBB_PROXY_USERNAME:-}
      QBB_PROXY_PASSWORD: ${QBB_PROXY_PASSWORD:-}

    # Volumes for persistence
    volumes:
      - logs-data:/app/data/logs
      - db-data:/app/data/db

      # Uncomment to override question pools from host
      # - ./data/questions:/app/data/questions:ro

    # Restart policy
    restart: unless-stopped

    # Health check
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f python || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M

    # Security options
    security_opt:
      - no-new-privileges:true

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Named volumes for better management
volumes:
  logs-data:
    driver: local
  db-data:
    driver: local
